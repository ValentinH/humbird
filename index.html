<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>HumBird üê¶üéµ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #1a1a2e;
      color: #eee;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100dvh;
      overflow: hidden;
      touch-action: none;
    }
    canvas {
      display: block;
      max-width: 100vw;
      max-height: 100dvh;
    }
    #ui-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }
    #ui-overlay.active { pointer-events: auto; }
    #start-screen, #game-over-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      text-align: center;
      padding: 2rem;
    }
    #start-screen.visible, #game-over-screen.visible {
      display: flex;
    }
    h1 { font-size: 2.5rem; }
    .subtitle { color: #888; font-size: 0.9rem; }
    .btn {
      background: #e94560;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 12px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .btn:active { transform: scale(0.95); }
    .hint { color: #666; font-size: 0.8rem; margin-top: 0.5rem; }
    #score-display {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      display: none;
    }
    #hits-display {
      position: absolute;
      top: 1rem;
      left: 1rem;
      font-size: 1rem;
      color: #e94560;
      display: none;
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>
  <div id="score-display">0</div>
  <div id="hits-display"></div>
  <div id="ui-overlay" class="active">
    <div id="start-screen" class="visible">
      <h1>üê¶üéµ HumBird</h1>
      <p class="subtitle">Sing the right note to fly through the gaps</p>
      <button class="btn" id="start-btn">‚ñ∂ Play</button>
      <p class="hint">Tap or click to move the bird up (voice control coming soon)</p>
    </div>
    <div id="game-over-screen">
      <h1>üíÄ Game Over</h1>
      <p>Score: <strong id="final-score">0</strong></p>
      <button class="btn" id="restart-btn">üîÑ Play Again</button>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ Constants ‚îÄ‚îÄ
    const NOTES = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
    const NOTE_COLORS = {
      C: '#e94560', D: '#f5a623', E: '#f7dc6f', F: '#4ecca3',
      G: '#3498db', A: '#9b59b6', B: '#e056a0'
    };
    const MAX_HITS = 10;
    const WALL_SPEED = 2.5;       // px per frame
    const WALL_INTERVAL = 120;    // frames between walls
    const GAP_HEIGHT_RATIO = 0.16; // gap = 16% of canvas height
    const BIRD_X_RATIO = 0.2;     // bird at 20% from left
    const GRAVITY = 0.35;
    const FLAP_FORCE = -6.5;
    const BIRD_SIZE_RATIO = 0.045;
    const WALL_WIDTH_RATIO = 0.12;
    const PUSHBACK_FRAMES = 40;   // frames to pause walls after hit

    // ‚îÄ‚îÄ DOM ‚îÄ‚îÄ
    const cvs = document.getElementById('game');
    const ctx = cvs.getContext('2d');
    const scoreEl = document.getElementById('score-display');
    const hitsEl = document.getElementById('hits-display');
    const overlay = document.getElementById('ui-overlay');
    const startScreen = document.getElementById('start-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const finalScoreEl = document.getElementById('final-score');

    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    let W, H, birdX, birdSize, wallWidth;
    let bird, walls, score, hits, frameCount, running, wallFreeze;

    function resize() {
      // mobile-first: use full viewport
      W = cvs.width = window.innerWidth;
      H = cvs.height = window.innerHeight;
      birdSize = Math.round(H * BIRD_SIZE_RATIO);
      wallWidth = Math.round(W * WALL_WIDTH_RATIO);
      birdX = Math.round(W * BIRD_X_RATIO);
    }
    window.addEventListener('resize', resize);
    resize();

    function noteToY(noteIndex) {
      // note 0 (C) = bottom, note 6 (B) = top
      // leave padding top/bottom
      const pad = H * 0.1;
      const range = H - pad * 2;
      return pad + range * (1 - noteIndex / (NOTES.length - 1));
    }

    function initGame() {
      bird = { y: H / 2, vy: 0 };
      walls = [];
      score = 0;
      hits = 0;
      frameCount = 0;
      running = true;
      wallFreeze = 0;
      scoreEl.style.display = 'block';
      hitsEl.style.display = 'block';
      scoreEl.textContent = '0';
      updateHitsDisplay();
      // Spawn first wall quickly
      spawnWall();
    }

    function updateHitsDisplay() {
      const hearts = MAX_HITS - hits;
      hitsEl.textContent = '‚ù§Ô∏è'.repeat(Math.max(0, hearts));
    }

    function spawnWall() {
      const noteIdx = Math.floor(Math.random() * NOTES.length);
      const note = NOTES[noteIdx];
      const gapCenter = noteToY(noteIdx);
      const gapH = H * GAP_HEIGHT_RATIO;
      walls.push({
        x: W + wallWidth,
        gapTop: gapCenter - gapH / 2,
        gapBottom: gapCenter + gapH / 2,
        note,
        noteIdx,
        passed: false,
        hitCooldown: 0
      });
    }

    function flap() {
      if (!running) return;
      bird.vy = FLAP_FORCE;
    }

    // ‚îÄ‚îÄ Input ‚îÄ‚îÄ
    cvs.addEventListener('touchstart', (e) => { e.preventDefault(); flap(); }, { passive: false });
    cvs.addEventListener('mousedown', () => flap());
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') { e.preventDefault(); flap(); }
    });

    // ‚îÄ‚îÄ Game Loop ‚îÄ‚îÄ
    function update() {
      if (!running) return;
      frameCount++;

      // Bird physics
      bird.vy += GRAVITY;
      bird.y += bird.vy;

      // Clamp
      if (bird.y < birdSize) { bird.y = birdSize; bird.vy = 0; }
      if (bird.y > H - birdSize) { bird.y = H - birdSize; bird.vy = 0; }

      // Spawn walls
      if (frameCount % WALL_INTERVAL === 0) spawnWall();

      // Wall freeze countdown
      if (wallFreeze > 0) {
        wallFreeze--;
      } else {
        // Move walls
        for (const w of walls) w.x -= WALL_SPEED;
      }

      // Collision & scoring
      const bRight = birdX + birdSize / 2;
      const bLeft = birdX - birdSize / 2;
      const bTop = bird.y - birdSize / 2;
      const bBot = bird.y + birdSize / 2;

      for (const w of walls) {
        if (w.hitCooldown > 0) w.hitCooldown--;

        if (bRight > w.x && bLeft < w.x + wallWidth) {
          const inGap = bTop > w.gapTop && bBot < w.gapBottom;
          if (!inGap && w.hitCooldown === 0) {
            hits++;
            w.hitCooldown = 60;
            updateHitsDisplay();

            // Snap all walls forward so bird is clearly before this wall
            const overlap = bRight - w.x + birdSize;
            for (const ww of walls) ww.x += overlap;

            // Freeze walls to give player time to adjust
            wallFreeze = PUSHBACK_FRAMES;

            if (hits >= MAX_HITS) {
              running = false;
              gameOver();
              return;
            }
            break; // only one collision per frame
          }
        }

        // Score
        if (!w.passed && w.x + wallWidth < birdX) {
          w.passed = true;
          score++;
          scoreEl.textContent = score;
        }
      }

      // Remove off-screen walls
      walls = walls.filter(w => w.x + wallWidth > -10);
    }

    function draw() {
      // Background
      ctx.fillStyle = '#1a1a2e';
      ctx.fillRect(0, 0, W, H);

      // Note lanes (subtle horizontal guides)
      ctx.globalAlpha = 0.08;
      for (let i = 0; i < NOTES.length; i++) {
        const y = noteToY(i);
        ctx.fillStyle = NOTE_COLORS[NOTES[i]];
        ctx.fillRect(0, y - 1, W, 2);
      }
      ctx.globalAlpha = 1;

      // Note labels on left edge
      ctx.font = `${Math.round(birdSize * 0.7)}px monospace`;
      ctx.textAlign = 'left';
      ctx.textBaseline = 'middle';
      for (let i = 0; i < NOTES.length; i++) {
        const y = noteToY(i);
        ctx.fillStyle = NOTE_COLORS[NOTES[i]];
        ctx.globalAlpha = 0.3;
        ctx.fillText(NOTES[i], 6, y);
      }
      ctx.globalAlpha = 1;

      // Walls
      for (const w of walls) {
        const color = NOTE_COLORS[w.note];

        // Top wall
        ctx.fillStyle = '#16213e';
        ctx.fillRect(w.x, 0, wallWidth, w.gapTop);

        // Bottom wall
        ctx.fillRect(w.x, w.gapBottom, wallWidth, H - w.gapBottom);

        // Gap edges glow
        ctx.fillStyle = color;
        ctx.fillRect(w.x, w.gapTop - 3, wallWidth, 3);
        ctx.fillRect(w.x, w.gapBottom, wallWidth, 3);

        // Note label on wall
        ctx.fillStyle = color;
        ctx.font = `bold ${Math.round(wallWidth * 0.35)}px monospace`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(w.note, w.x + wallWidth / 2, (w.gapTop + w.gapBottom) / 2);
      }

      // Bird
      const bx = birdX;
      const by = bird.y;
      const r = birdSize / 2;

      // Body
      ctx.fillStyle = '#f5a623';
      ctx.beginPath();
      ctx.arc(bx, by, r, 0, Math.PI * 2);
      ctx.fill();

      // Eye
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(bx + r * 0.3, by - r * 0.2, r * 0.25, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#1a1a2e';
      ctx.beginPath();
      ctx.arc(bx + r * 0.35, by - r * 0.2, r * 0.12, 0, Math.PI * 2);
      ctx.fill();

      // Beak
      ctx.fillStyle = '#e94560';
      ctx.beginPath();
      ctx.moveTo(bx + r, by);
      ctx.lineTo(bx + r * 1.5, by + r * 0.15);
      ctx.lineTo(bx + r, by + r * 0.3);
      ctx.fill();

      // Wing
      const wingFlap = Math.sin(frameCount * 0.15) * r * 0.3;
      ctx.fillStyle = '#d4941e';
      ctx.beginPath();
      ctx.ellipse(bx - r * 0.3, by + wingFlap, r * 0.5, r * 0.25, -0.3, 0, Math.PI * 2);
      ctx.fill();

      // Hit flash
      if (walls.some(w => w.hitCooldown > 20)) {
        ctx.fillStyle = 'rgba(233, 69, 96, 0.15)';
        ctx.fillRect(0, 0, W, H);
      }
    }

    function gameOver() {
      scoreEl.style.display = 'none';
      hitsEl.style.display = 'none';
      finalScoreEl.textContent = score;
      overlay.classList.add('active');
      gameOverScreen.classList.add('visible');
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    // ‚îÄ‚îÄ Start / Restart ‚îÄ‚îÄ
    function startGame() {
      overlay.classList.remove('active');
      startScreen.classList.remove('visible');
      gameOverScreen.classList.remove('visible');
      initGame();
    }

    document.getElementById('start-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      startGame();
    });
    document.getElementById('restart-btn').addEventListener('click', (e) => {
      e.stopPropagation();
      startGame();
    });

    // Init bird for title screen draw
    bird = { y: H / 2, vy: 0 };
    walls = [];
    running = false;

    // Initial draw (just background)
    draw();
    gameLoop();
  </script>
</body>
</html>
